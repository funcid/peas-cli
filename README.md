# peas-cli

**Проблематика:**

1. **Critical:** Во время множественного скачивания тяжелого файла с одного или нескольких серверов, может произойти отказ в обслуживании из-за высокой и неравномерной нагрузки
2. **Critical:** В случае завершения работы дистрибьютора, entrypoint для загрузки будет утерян
3. **High:** Сервер может находиться в другом регионе, что сильно повышает latency
4. **High:** Протокол загрузки сильно зависит от дистрибьютора, поэтому может быть использован неоптимальный

<img src="https://user-images.githubusercontent.com/42806772/232248325-082f44df-d2e4-4f5c-b4c0-e0862b7ea90a.png" width="500">

**Решение:**

Необходимо создать несколько источников раздачи файла, однако тогда получатель будет знать все хосты, которые уже получили фрагменты файла (далее будет использовано слово - **партиция**). Это необходимый trade-off для достижения параллельного получения фрагментов. По сути, каждый клиент становится сервером раздачи (далее будет использовано слово - **трекер**). 

<img src="https://user-images.githubusercontent.com/42806772/232248309-52c1e6de-1f58-42d6-910c-a00761f0bec3.png" width="500">

**Область применения:**

1. Оптимизация механизма репликации баз данных (нужно доказать на примерах)
2. Ускорение отправки snapshot версий на несколько backup серверов
3. Выпуск большого обновления клиентской части какой-либо игры
4. Быстрая загрузка первичного ПО на только что купленные хосты (+ansible)

**Что отдаем взамен:**

1. Приходится доверять .peas файлу
2. Все участники знают адреса друг друга
3. Trade-off между ускорением на мультисессионной загрузке и валидации хэш-сумм (поэтому на маленьких файлах, скорость может только замедлиться) 
4. Слабая защита на бесконечное добавление IP-адресов владельцев в peas файл (нужно придумать механизировано актуализации владельцев, например по времени)

**Подробнее про раздачу и установку:**

Дистрибьютор { A } создал горошину и вписал свой IP во владельцы со всеми партициями, далее клиенты { B, C, D, … } получили по телеграмму горошину, выполнили команду ```peas install file.peas```:

1. Все узнали о владельце { A }, который разделил файл на N партиций размером M, он по очереди, уникально раздает партиции, которых не хватает 
2. Когда клиенты получили первые партиции, они отправили всем владельцам пакет, о том что, они получили партиции { a, b, c, d, … },  то есть отправили только { A }
3. { A } получил пакеты о изменении количества владельцев и передал эту информацию всем своим клиентам { B, C, D, … }
4. Клиенты стали и серверами, ведь у них есть партиции которых не хватает и они досягаемы
5. Теперь при получении любым клиентом партиции, все участники раздачи узнают о этом и могут запросить эту же партицию
